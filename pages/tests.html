<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç—ã –ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ - –ü–æ—Ä—Ç–∞–ª –ö–ú–ö–í–ö</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .test-card {
            cursor: pointer;
            transition: var(--transition);
        }

        .test-card:hover {
            transform: translateY(-5px);
        }

        .test-info {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .test-stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-stat-icon {
            font-size: 1.2rem;
            color: var(--accent);
        }

        .test-container {
            background-color: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .question-container {
            background-color: var(--background);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .rating-scale {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            flex: 1;
            min-width: 80px;
        }

        .rating-option input[type="radio"] {
            appearance: none;
            width: 40px;
            height: 40px;
            border: 2px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-option input[type="radio"]:checked {
            background-color: var(--accent);
            border-color: var(--accent);
        }

        .rating-option span {
            font-size: 0.8rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        .progress-section {
            margin-bottom: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
        }

        .test-result {
            text-align: center;
            padding: 3rem 0;
        }

        .result-score {
            font-size: 3rem;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .recommendations {
            background-color: var(--background);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            border-left: 4px solid var(--accent);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <nav class="container">
            <div class="logo">‚öì <span><strong>–ö–ú–ö–í–ö</strong><br><span class="logo-text">–¢–µ—Å—Ç—ã</span></span></div>
            <ul class="nav-menu">
                <li><a href="../index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="vuzy.html" class="nav-link">–í–£–ó—ã</a></li>
                <li><a href="tests.html" class="nav-link">–¢–µ—Å—Ç—ã</a></li>
            </ul>
            <div class="user-menu">
                <button class="btn-profile" id="profileBtn" onclick="if(AppState.isLoggedIn) window.location.href='profile.html';">
                    –ü—Ä–æ—Ñ–∏–ª—å
                </button>
            </div>
        </nav>
    </header>

    <!-- MAIN -->
    <main style="padding: 2rem 0; min-height: 600px;">
        <div class="container">
            <h1 style="margin-bottom: 1rem;">–ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã</h1>
            <p class="text-secondary" style="font-size: 1.1rem; margin-bottom: 2rem;">
                –ü—Ä–æ–π–¥–∏ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç–∏
            </p>

            <!-- TESTS GRID -->
            <div id="testsContainer" class="grid grid-2" style="margin-bottom: 3rem;">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤...</p>
            </div>
        </div>
    </main>

    <!-- TEST MODAL -->
    <div id="testModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <span class="modal-close" onclick="Utils.closeModal('testModal')">&times;</span>
            <div id="testContent"></div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="container footer-content">
            <div class="footer-section">
                <h3>–†–µ—Å—É—Ä—Å—ã</h3>
                <ul>
                    <li><a href="vuzy.html">–í–£–ó—ã</a></li>
                    <li><a href="tests.html">–¢–µ—Å—Ç—ã</a></li>
                    <li><a href="library.html">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
                <ul>
                    <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 –ö–ú–ö–í–ö. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script src="../js/app.js"></script>
    <script src="../js/tests.js"></script>
    <script>
        let allTests = [];
        let currentTestEngine = null;

        async function loadTests() {
            allTests = await Utils.fetchJSON('../data/tests.json');
            if (allTests && allTests.tests) {
                displayTests(allTests.tests);
            }
        }

        function displayTests(tests) {
            const container = document.getElementById('testsContainer');
            container.innerHTML = '';

            tests.forEach(test => {
                const isFavorite = AppState.userProgress.tests.includes(test.id);
                const hasResult = AppState.userProgress.testResults[test.id];

                const card = document.createElement('div');
                card.className = 'card test-card';
                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">${test.name}</h3>
                        <span class="badge badge-primary">${test.author}</span>
                    </div>
                    <div class="card-body">
                        <p>${test.description}</p>
                        <div class="test-info">
                            <div class="test-stat">
                                <span class="test-stat-icon">‚è±Ô∏è</span>
                                <span>${test.duration}</span>
                            </div>
                            <div class="test-stat">
                                <span class="test-stat-icon">‚ùì</span>
                                <span>${test.questions} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                            </div>
                            <div class="test-stat">
                                <span class="test-stat-icon">üìã</span>
                                <span>${test.license}</span>
                            </div>
                        </div>
                        ${hasResult ? `<p style="margin-top: 1rem; color: var(--success);"><strong>‚úì –ü—Ä–æ–π–¥–µ–Ω</strong> - –†–µ–∑—É–ª—å—Ç–∞—Ç: ${hasResult.score}%</p>` : ''}
                    </div>
                    <div class="card-footer">
                        ${hasResult ? `<button class="btn btn-secondary btn-small" onclick="startTest('${test.id}', '${test.name}')">–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>` : `<button class="btn btn-primary btn-small" onclick="startTest('${test.id}', '${test.name}')">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>`}
                        <button class="btn btn-accent btn-small" onclick="AppState.addFavoriteVuz('${test.id}'); Utils.showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!', 'success');">‚òÜ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function startTest(testId, testName) {
            currentTestEngine = new TestEngine(testId);
            currentTestEngine.questions = generateDemoQuestions(10);
            currentTestEngine.testData = { name: testName };

            renderTestSession();
            Utils.openModal('testModal');
        }

        function renderTestSession() {
            const content = document.getElementById('testContent');

            if (currentTestEngine.currentQuestion < currentTestEngine.questions.length) {
                // –†–µ–Ω–¥–µ—Ä –≤–æ–ø—Ä–æ—Å–∞
                const progress = Math.round((currentTestEngine.currentQuestion / currentTestEngine.questions.length) * 100);

                content.innerHTML = `
                    <h2 style="margin-bottom: 1rem;">${currentTestEngine.testData.name}</h2>

                    <div class="progress-section">
                        <p style="margin-bottom: 0.5rem;">–í–æ–ø—Ä–æ—Å ${currentTestEngine.currentQuestion + 1} –∏–∑ ${currentTestEngine.questions.length}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                    </div>

                    <div class="question-container">
                        ${renderTestQuestion(currentTestEngine)}
                    </div>

                    <div style="display: flex; gap: 1rem; justify-content: space-between;">
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${currentTestEngine.currentQuestion === 0 ? 'disabled' : ''}>
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                        ${currentTestEngine.currentQuestion === currentTestEngine.questions.length - 1 
                            ? `<button class="btn btn-primary" onclick="submitTest()">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>` 
                            : `<button class="btn btn-primary" onclick="nextQuestion()">–î–∞–ª–µ–µ ‚Üí</button>`
                        }
                    </div>
                `;
            }
        }

        function nextQuestion() {
            if (currentTestEngine.nextQuestion()) {
                renderTestSession();
            }
        }

        function previousQuestion() {
            if (currentTestEngine.previousQuestion()) {
                renderTestSession();
            }
        }

        function submitTest() {
            const result = currentTestEngine.submitTest();
            const recommendations = generateRecommendations(result.score, currentTestEngine.testData.name);

            const content = document.getElementById('testContent');
            content.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 1rem;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>

                <div class="test-result">
                    <div class="result-score">${result.score}%</div>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem;">–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞</p>

                    <p><strong>–í–æ–ø—Ä–æ—Å–æ–≤ –æ—Ç–≤–µ—Ç–µ–Ω–æ:</strong> ${result.total} –∏–∑ ${result.total}</p>
                    <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${result.percentage}%</p>
                </div>

                <div class="recommendations">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <ul>
                        ${recommendations.map(r => `<li style="margin-bottom: 0.5rem;">${r}</li>`).join('')}
                    </ul>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                    <button class="btn btn-primary" onclick="Utils.closeModal('testModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button class="btn btn-secondary" onclick="window.location.href='tests.html'">–ö —Ç–µ—Å—Ç–∞–º</button>
                </div>
            `;

            AppState.addToHistory('–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞', currentTestEngine.testData.name + ' - ' + result.score + '%');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadTests();
    </script>
</body>
</html>
